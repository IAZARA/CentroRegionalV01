<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Observatorio de Drogas Sintéticas | Ministerio de Seguridad Nacional{% endblock %}</title>

    <!-- Poncho CSS (Sistema de diseño del Gobierno Argentino) -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/poncho.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/icono-arg.css') }}">
    
    <!-- Bootstrap CSS (requerido por Poncho) -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    <!-- Estilos para marca de agua -->
    <style>
        body {
            position: relative;
        }
        
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('{{ url_for("static", filename="img/logo_ministerio_seguridad_nacional.png") }}');
            background-repeat: no-repeat;
            background-position: center center;
            background-size: 30%;
            opacity: 0.05;
            z-index: -1;
            pointer-events: none;
        }
    </style>

    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">

    <!-- Extra CSS -->
    {% block extra_css %}{% endblock %}
</head>

<body class="{{ 'with-sidebar' if current_user.is_authenticated else 'no-sidebar' }}">
    <!-- Header Gubernamental (Poncho) -->
    <header class="navbar navbar-default"> {# Simplified navbar class for BS3/Poncho compatibility #}
        <div class="container-fluid"> {# container-fluid is generally fine #}
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbarNav" aria-expanded="false">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/"> {# d-flex and align-items-center are BS5, use custom CSS or simpler structure if needed #}
                    <img src="{{ url_for('static', filename='img/Logo MInisterio en negro.png') }}" alt="Logo Ministerio de Seguridad" height="50"> {# Adjusted height for BS3 navbar #}
                    {# Removed nested divs for simplicity, text can be styled directly or with spans if needed #}
                    <span style="font-size: 16px; font-weight: bold; vertical-align: middle; margin-left: 10px;">Ministerio de Seguridad Nacional</span><br>
                    <span class="small text-muted" style="font-size: 12px; vertical-align: middle; margin-left: 10px;">Observatorio de Drogas Sintéticas</span>
                </a>
            </div>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="nav navbar-nav navbar-right"> {# Simplified nav alignment for BS3/Poncho #}
                    {% if current_user.is_authenticated %}
                    <li>
                        <p class="navbar-text">Bienvenido, {{ current_user.username }}</p> {# Use navbar-text for non-link items #}
                    </li>
                    <li>
                        <a href="{{ url_for('auth.logout') }}" class="text-danger">Cerrar sesión</a>
                    </li>
                    {% else %}
                    <li>
                        <a href="{{ url_for('auth.login') }}" class="text-danger">Iniciar sesión</a>
                    </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </header>

    <!-- Contenedor Principal -->
    <div class="container"> {# Using .container for potentially fixed-width layout, or keep .container-fluid if full-width is desired #}
        <!-- Flash Messages -->
        <div class="row">
            <div class="col-md-12">
                {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                {% for category, message in messages %}
                <div class="alert alert-{{ category }} alert-dismissible" role="alert">
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    {{ message }}
                </div>
                {% endfor %}
                {% endif %}
                {% endwith %}
            </div>
        </div>

        <!-- Main Content -->
        <main class="row">
            <div class="col-md-12">
                 {% block content %}{% endblock %}
            </div>
        </main>
    </div>

    <!-- jQuery (requerido por Bootstrap 3 y Poncho) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

    <!-- Bootstrap JS (requerido por Poncho) -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    
    <!-- Poncho JS -->
    <script src="https://argob.github.io/poncho/dist/js/poncho.min.js"></script>

    <!-- Custom JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>

    <!-- Extra JavaScript -->
    {% block extra_js %}{% endblock %}

    <!-- Toast Flash Messages (Bootstrap 3 style) -->
    {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
    {# Toasts are not a standard Bootstrap 3 component. Implementing a simple alert-based notification system or using a BS3 compatible plugin would be needed.
       For now, the above flash messages will serve the purpose. If true "toast" behavior is needed, it would require more custom JS or a library.
       The existing toast HTML is BS5 and won't work correctly with BS3.
       This section is commented out to avoid rendering broken BS5 toasts.
    <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
        {% for category, message in messages %}
        <div class="toast align-items-center text-white bg-{{ category }} border-0" role="alert" aria-live="assertive"
            aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body">
                    {{ message }}
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"
                    aria-label="Close"></button>
            </div>
        </div>
        {% endfor %}
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Custom script to show/hide these alerts or use a BS3 toast plugin
        });
    </script>
    #}
    {% endif %}
    {% endwith %}

    <!-- Footer Gubernamental (Poncho) -->
    <footer class="main-footer"> {# Poncho typically uses 'main-footer' class #}
        <div class="container">
            <div class="row">
                <div class="col-md-6 col-sm-6">
                     <a href="https://www.argentina.gob.ar" target="_blank">
                        <img src="{{ url_for('static', filename='img/escudo_HD.png') }}" alt="Escudo Nacional Argentino" height="50" class="ar-logo">
                     </a>
                </div>
                <div class="col-md-6 col-sm-6 text-right"> {# text-right for BS3 #}
                    <p class="text-muted small">© 2025 Observatorio de Drogas Sintéticas</p>
                    <p class="text-muted small">Ministerio de Seguridad Nacional. Todos los derechos reservados</p>
                </div>
            </div>
        </div>
    </footer>
</body>

</html>